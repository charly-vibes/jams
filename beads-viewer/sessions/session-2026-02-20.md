# BeadsView Development Session - 2026-02-20

## Overview

Created a new single-page web application to visualize `.beads/issues.jsonl` files from GitHub repositories. The app provides a clean interface for browsing, filtering, and exploring issues tracked with the `bd` CLI tool.

## Implementation

### Architecture

Built as a self-contained HTML file with inline CSS and JavaScript, following the same pattern as `spec-viewer`. Key design decisions:

1. **GitHub API Integration**: Fetches `.beads/issues.jsonl` directly from repositories using the GitHub API
2. **JSONL Parsing**: Each line is parsed as a separate JSON object representing an issue
3. **Client-side Filtering**: All filtering, searching, and sorting happens in the browser
4. **Dependency Visualization**: Shows "blocks" and "blocked by" relationships between issues

### Features Implemented

#### Repository Loading
- Accepts GitHub URLs (`github.com/owner/repo`) or shorthand (`owner/repo`)
- Fetches `.beads/issues.jsonl` from the default branch
- Parses JSONL format (one JSON object per line)
- Handles missing files with clear error messages

#### Issue List (Sidebar)
- Displays all issues with ID, title, status, type, and priority
- Real-time filtering by:
  - Status: all, open, closed
  - Type: all, task, bug, feature, epic
  - Priority: all, P1, P2, P3
- Search by title or description
- Click to view details
- Shows statistics (total/open/closed counts)

#### Issue Details (Main Area)
- Full metadata display:
  - ID, title, description (preserves formatting)
  - Status badge, type badge, priority badge
  - Owner, created/updated timestamps
  - Close reason and timestamp (if applicable)
- Dependency visualization:
  - "Blocked By" section shows issues that must complete first
  - "Blocks" section shows issues waiting on this one
  - Click dependencies to navigate

#### Visual Design
- Minimalist grayscale color scheme
- Clean typography (Source Serif 4 for headings, DM Sans for UI, JetBrains Mono for code)
- Responsive layout with sidebar and main content area
- Dark mode support (auto-detects system preference)
- Smooth transitions and hover states

### Data Structure

Issues from `.beads/issues.jsonl` have this structure:

```json
{
  "id": "fabbro-096",
  "title": "Issue title",
  "description": "Full description...",
  "status": "open|closed",
  "priority": 1-3,
  "issue_type": "task|bug|feature|epic",
  "owner": "email@example.com",
  "created_at": "2026-01-29T18:06:45Z",
  "created_by": "name",
  "updated_at": "2026-01-29T19:23:27Z",
  "closed_at": "2026-01-29T19:23:27Z",
  "close_reason": "Closed",
  "dependencies": [
    {
      "issue_id": "fabbro-096",
      "depends_on_id": "fabbro-10e",
      "type": "blocks",
      "created_at": "2026-01-29T18:07:09Z",
      "created_by": "charly vibes"
    }
  ]
}
```

### Technical Implementation

#### Dependency Logic
The dependency parsing was the most complex part:

1. **Blocks relationships**: If issue A has `{type: "blocks", depends_on_id: B}` in its dependencies, then A blocks B
2. **Blocked By**: To find what blocks issue X, scan all other issues for dependencies where `depends_on_id === X.id` and `type === "blocks"`

This bidirectional lookup allows showing both perspectives in the UI.

#### URL State Management
- Stores `?repo=owner/repo&issue=issue-id` in URL
- Supports direct linking to specific issues
- Initializes from URL on page load
- Updates URL when navigating between issues

### Testing

Tested with real repositories:
- `charly-vibes/fabbro` (Go project with many issues)
- Can test with any repo that has `.beads/issues.jsonl`

## Insights

1. **JSONL Format**: The newline-delimited JSON format is simple and git-friendly. Each line is a complete JSON object, making it easy to parse and resilient to line-based git operations.

2. **Dependency Model**: The "blocks" relationship type is unidirectional in the data but needs bidirectional display. This required scanning all issues to build the reverse index.

3. **GitHub API**: Using the raw content API (`Accept: application/vnd.github.v3.raw`) is simpler than decoding base64 from the default response.

4. **Badge Design**: Color-coded badges for status/type/priority provide quick visual scanning while maintaining accessibility in both light and dark modes.

## Enhancements (Same Session)

After initial implementation, several major enhancements were added based on user feedback:

### Graph View with Interactive Visualization

Added a complete graph visualization mode to complement the list view:

**Implementation:**
- SVG-based rendering with hierarchical layout algorithm
- Nodes positioned by dependency level (root issues at top, dependencies flow downward)
- Issues grouped by level and spaced evenly across width
- Curved Bézier paths for edges showing "blocks" relationships
- Color-coded nodes: blue for open issues, gray for closed
- Node labels trimmed to show only suffix (e.g., "khz" instead of "fabbro-khz") to reduce clutter

**Interaction:**
- View toggle in header to switch between List and Graph modes
- Pan by dragging, zoom with scroll wheel or control buttons
- Reset button to restore default zoom/pan state
- Responsive to window size with dynamic layout calculation

### Focus Mode for Dependency Exploration

To solve the problem of visual clutter from many root-level issues, implemented a sophisticated focus system:

**Transitive Dependency Highlighting:**
- Single-click on a node focuses on its entire dependency chain
- Uses recursive traversal to find ALL connected issues (not just immediate neighbors)
- Finds both ancestors (issues that block this) and descendants (issues this blocks)
- Highlights the complete connected subgraph transitively

**Visual Feedback:**
- Focused node gets bold stroke and drop shadow
- Related nodes remain fully visible
- Unrelated nodes dimmed to 15% opacity
- Connected edges highlighted in accent color, others dimmed to 10%
- Info box shows currently focused issue
- Click background to clear focus and show all nodes

**Algorithm:**
```javascript
// Recursive traversal for transitive closure
findDescendants(issueId) {
  // Follow all "blocks" edges recursively
}

findAncestors(issueId) {
  // Find all issues that transitively block this one
}
```

This approach solved the "crowded graph" problem by letting users explore one dependency chain at a time while keeping context visible.

### Modal View for Quick Issue Inspection

Double-clicking a node opens issue details in a modal overlay:

**Features:**
- Full issue metadata and description
- Dependency lists with click-to-navigate
- Stays in graph view (no context loss)
- Keyboard shortcut: ESC to close
- Click outside or X button to close
- Navigate between related issues within modal

**Benefits:**
- Explore issues without losing your place in the graph
- Quick inspection workflow for understanding dependency chains
- Modal prevents accidental navigation away from graph

### Branch Selection with Smart Defaults

Implemented intelligent branch detection to support `bd sync` workflow:

**Priority Order:**
1. Branch from URL parameter (for direct links)
2. `beads-sync` branch (if exists) - primary beads workflow branch
3. Repository default branch
4. `main` as final fallback

**Implementation:**
- Fetches all branches via GitHub API (paginated)
- Branch selector dropdown in sidebar
- Labels special branches: "(beads)" and "(default)"
- Switch branches without page reload
- Branch included in shareable URLs
- Background loading to not block initial render

**Why beads-sync First:**
The `bd sync` command exports issues to `.beads/issues.jsonl` on the `beads-sync` branch. This makes it the canonical source for issue data in beads workflows, so checking it first provides the most up-to-date view.

### Navigation Improvements

- Added home link (←) to header for returning to jams index
- Consistent with other jams apps
- Hover effect with accent color

## Technical Challenges Solved

### 1. Graph Layout Algorithm
Implemented a level-based hierarchical layout:
- Calculate dependency levels by traversing from root nodes
- Handle cycles and disconnected components gracefully
- Dynamic spacing based on number of nodes per level
- Curved edges to improve visual clarity

### 2. Event Handling Conflicts
Solved click/double-click interference:
- Single-click focuses the node
- Double-click opens modal
- Used `stopPropagation()` to prevent background click handler
- Proper event delegation for dynamically created nodes

### 3. Transitive Closure Performance
Optimized recursive dependency traversal:
- Used Set to track visited nodes (prevent infinite loops)
- Early termination when all connected nodes found
- Efficient edge lookup with proper data structures

### 4. State Management
Coordinated state across multiple views:
- Shared `currentIssue` between list and graph
- Focus state (`focusedIssueId`) separate from selection
- View mode (`currentView`) controls which UI is visible
- Graph transform state (pan/zoom) persists across view switches

## Files Modified

- `spec/functionality.md` - Feature specification
- `index.html` - Complete self-contained app with all features
- `sessions/session-2026-02-20.md` - This document
- `/jams/script.js` - Registered beads-viewer in APPS array

## Future Enhancements

Potential additions for future versions:

- Filtering by owner/creator in graph view
- Export graph as SVG/PNG
- Timeline view showing issue activity over time
- Epic/child relationship visualization (if bd adds this)
- Comment display (if supported in future bd versions)
- Minimap for large graphs
- Search highlighting in graph
- Custom layout algorithms (force-directed, circular)

## Commits Summary

1. `feat(beads-viewer): add issue tracker visualization app` - Initial implementation
2. `feat(beads-viewer): add interactive dependency graph view` - Graph visualization
3. `refactor(beads-viewer): trim issue prefix from graph node labels` - UI polish
4. `feat(beads-viewer): add focus mode to graph view` - Transitive highlighting
5. `feat(beads-viewer): add modal view and improve graph interactions` - Modal + home link
6. `feat(beads-viewer): add branch selection with smart defaults` - Branch selector
