# Piano - Session 2026-01-06

## Overview
Initial implementation of interactive Piano keyboard app that can be played with mouse clicks or computer keyboard, generating piano sounds using Web Audio API.

## Implementation Decisions

### Architecture
- Single-page vanilla JavaScript app
- Web Audio API for programmatic sound generation
- No external audio files or dependencies
- Real-time note synthesis
- Visual feedback for active keys

### Sound Generation Strategy

**Web Audio API Implementation:**
- `AudioContext` for audio processing
- `OscillatorNode` for tone generation
- `GainNode` for amplitude envelope
- Sine wave oscillator for pure tones

**ADSR Envelope:**
- **Attack**: 10ms linear ramp (quick hammer strike)
- **Decay**: 1.5s exponential decay (string dampening)
- **Sustain**: Natural exponential curve
- **Release**: Automatic after 1.5s

### Keyboard Layout

**One Octave (C4 to C5):**
- 8 white keys (C, D, E, F, G, A, B, C)
- 5 black keys (C#, D#, F#, G#, A#)
- Standard piano key positioning
- Realistic visual proportions

**Computer Keyboard Mapping:**
- White keys: A, S, D, F, G, H, J, K (home row)
- Black keys: W, E, T, Y, U (top row)
- Intuitive layout matching piano structure

### UI/UX Decisions
- Minimalist grayscale design
- White keys with black borders
- Black keys positioned absolutely over white keys
- Active state visual feedback (darker background)
- Keyboard letter hints on each key
- Instructions below piano
- Hover effects for interactivity cues

### Key Positioning

**White Keys:**
- Flexbox layout with equal width distribution
- 2px gap between keys
- Rounded bottom corners

**Black Keys:**
- Absolute positioning at 60% height
- Positioned between specific white keys
- Z-index 10 to appear on top
- Percentage-based left positioning:
  - C# at 7.5%
  - D# at 20%
  - F# at 45%
  - G# at 57.5%
  - A# at 70%

### Event Handling

#### Mouse Events
- `mousedown`: Play note and add active class
- `mouseup`: Remove active class
- `mouseleave`: Remove active class (handles drag-off)

#### Keyboard Events
- `keydown`: Check for valid key, prevent repeat, play note
- `keyup`: Remove active state
- Active keys tracked in Set to prevent key repeat

### Code Structure

#### JavaScript Organization
- `NOTE_FREQUENCIES`: Object mapping notes to Hz
- `audioContext`: Global Web Audio context
- `activeKeys`: Set tracking pressed keyboard keys
- `initAudio()`: Initialize AudioContext
- `setupKeyListeners()`: Attach all event listeners
- `playNote()`: Create and play oscillator with envelope

#### CSS Layout
- `.piano`: Container with gray background
- `.white-keys`: Flex container for white keys
- `.black-keys`: Absolute container for black keys
- `.key`: Base styles for all keys
- `.key.white`: White key specific styles
- `.key.black`: Black key specific styles
- `.active`: Active state for visual feedback

## Technical Insights

1. **Web Audio API**: Requires user interaction to initialize due to browser autoplay policies
2. **Oscillator Lifecycle**: Each note creates new oscillator that self-destructs after playing
3. **Key Repeat Prevention**: Set-based tracking prevents rapid-fire from held keys
4. **Exponential Decay**: More natural sound decay than linear
5. **Sine Wave Choice**: Purest tone, closest to tuning fork (can be changed to triangle/sawtooth for different timbres)

## Browser Compatibility

- **Web Audio API**: Well supported in modern browsers
- **AudioContext**: Requires webkit prefix in older Safari
- **Arrow Functions**: ES6 feature, good support
- **Set**: ES6 feature, good support
- **Template Literals**: ES6 feature, good support

## Sound Quality Notes

**Current Implementation:**
- Simple sine wave oscillator
- Basic ADSR envelope
- No harmonics or overtones
- Pure, synthetic sound

**Characteristics:**
- Clean, clear tones
- Minimal CPU usage
- Instant response
- No loading time
- Unlimited polyphony (browser limited)

## Future Enhancements

Potential improvements for future sessions:
- Add multiple octaves
- Implement sustain pedal (spacebar)
- Add volume control
- Include different instrument sounds (organ, strings, etc.)
- Add reverb effect
- Implement recording functionality
- Show currently playing notes visually
- Add metronome
- Include sheet music display
- Add MIDI keyboard support
- Implement velocity sensitivity
- Add chord recognition
- Include scale helper overlays
- Add tutorial mode for learning

## Performance Considerations

- Each note creates disposable oscillator (garbage collected)
- Audio nodes cleaned up automatically after use
- No memory leaks from event listeners
- Minimal DOM manipulation
- CSS transitions for smooth visual feedback
- No performance impact from inactive keys

## Testing Notes

Test cases to verify:
- Mouse click on white keys
- Mouse click on black keys
- Keyboard press for all mapped keys
- Multiple simultaneous keys
- Key repeat prevention
- Visual feedback timing
- Sound generation for each note
- Browser compatibility (Chrome, Firefox, Safari)
- Mobile touch support
- Audio initialization on first interaction
